From 27f3bc8e6e08dee4073ce87fd191a2b1f20d12ed Mon Sep 17 00:00:00 2001
From: orbea <orbea@riseup.net>
Date: Wed, 6 Jul 2022 18:03:09 -0700
Subject: [PATCH] Fix the build with libressl

check_ssl.c:240: undefined reference to `SSL_set0_wbio'
---
 keepalived/check/check_ssl.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/keepalived/check/check_ssl.c b/keepalived/check/check_ssl.c
index 0155fce..889205e 100644
--- a/keepalived/check/check_ssl.c
+++ b/keepalived/check/check_ssl.c
@@ -234,7 +234,7 @@ ssl_connect(thread_ref_t thread, int new_req)
 		BIO_get_fd(req->bio, &bio_fd);
 		if (fcntl(bio_fd, F_SETFD, fcntl(bio_fd, F_GETFD) | FD_CLOEXEC) == -1)
 			log_message(LOG_INFO, "Setting CLOEXEC failed on ssl socket - errno %d", errno);
-#ifdef HAVE_SSL_SET0_RBIO
+#if defined(HAVE_SSL_SET0_RBIO) && !defined(LIBRESSL_VERSION_NUMBER)
 		BIO_up_ref(req->bio);
 		SSL_set0_rbio(req->ssl, req->bio);
 		SSL_set0_wbio(req->ssl, req->bio);
